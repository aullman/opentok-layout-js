/*!
 *  opentok-layout-js (http://github.com/aullman/opentok-layout-js)
 *  
 *  Automatic layout of video elements (publisher and subscriber) minimising 
 *  white-space for the OpenTok on WebRTC API.
 *
 *  @Author: Adam Ullman (http://github.com/aullman)
 *  @Copyright (c) 2014 Adam Ullman
 *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)
**/
!function(){var t=function(t,i,e,o,a,r){var n={left:i+"px",top:e+"px",width:o+"px",height:a+"px"},g=function(){var i=t.querySelector(".OT_root");if(i){var e=i.style.width;i.style.width=o+"px",i.style.width=e||""}};r&&$?($(t).stop(),$(t).animate(n,r.duration||200,r.easing||"swing",function(){g(),r.complete&&r.complete.call(this)})):OT.$.css(t,n),g()},i=function(t,i){var e=OT.$.css(t,i);return e?parseInt(e,10):0},e=function(t){var i=OT.$.height(t);return i?parseInt(i,10):0},o=function(t){var i=OT.$.width(t);return i?parseInt(i,10):0},a=function(e,o,a,r,n,g,d,h,l){var s,u=e.length,b=function(t,i){for(var e,r,n,g,d,h,l,b=1;u>=b;b++){var R=b,f=Math.ceil(u/R);l=Math.floor(a/f),h=Math.floor(o/R),tRatio=l/h,tRatio>i?(tRatio=i,l=h*tRatio):t>tRatio&&(tRatio=t,h=l/tRatio);var v=h*l*u;(void 0===e||v>e)&&(e=v,g=l,d=h,r=R,n=f)}return{maxArea:e,targetCols:r,targetRows:n,targetHeight:g,targetWidth:d,ratio:s}};if(g){var R=e.length>0&&e[0].querySelector("video");s=R&&R.videoHeight&&R.videoWidth?b(R.videoHeight/R.videoWidth,R.videoHeight/R.videoWidth):b(.75,.75)}else s=b(d,h);for(var f=s.targetRows*s.targetCols-u,v=f*s.targetWidth/2,c=(s.targetRows-1)*s.targetCols,p=(a-s.targetRows*s.targetHeight)/2,m=(o-s.targetCols*s.targetWidth)/2,T=0,x=0,y=0;y<e.length;y++){var O=e[y];y%s.targetCols===0?(T=m,y==c&&(T+=v),x+=0===y?p:s.targetHeight):T+=s.targetWidth,OT.$.css(O,"position","absolute");var M=s.targetWidth-i(O,"paddingLeft")-i(O,"paddingRight")-i(O,"marginLeft")-i(O,"marginRight")-i(O,"borderLeft")-i(O,"borderRight"),w=s.targetHeight-i(O,"paddingTop")-i(O,"paddingBottom")-i(O,"marginTop")-i(O,"marginBottom")-i(O,"borderTop")-i(O,"borderBottom");t(O,T+r,x+n,M,w,l)}},r=function(t,r){if("none"!==OT.$.css(t,"display")){var n=t.getAttribute("id");n||(n="OT_"+OT.$.uuid(),t.setAttribute("id",n));var g=e(t)-i(t,"borderTop")-i(t,"borderBottom"),d=o(t)-i(t,"borderLeft")-i(t,"borderRight"),h=g/d,l=0,s=0,u=t.querySelectorAll("#"+n+">."+r.bigClass),b=t.querySelectorAll("#"+n+">*:not(."+r.bigClass+")");if(u.length>0&&b.length>0){var R=u[0].querySelector("video");bigRatio=R&&R.videoHeight&&R.videoWidth?R.videoHeight/R.videoWidth:.75;var f,v;h>bigRatio?(f=d,v=Math.min(Math.floor(g*r.bigPercentage),d*bigRatio),s=v):(v=g,f=Math.min(d*r.bigPercentage,Math.floor(v/bigRatio)),l=f),a(u,f,v,0,0,r.bigFixedRatio,r.bigMinRatio,r.bigMaxRatio,r.animate)}else u.length>0&&0===b.length&&a(u,d,g,0,0,r.bigFixedRatio,r.bigMinRatio,r.bigMaxRatio,r.animate);a(b,d-l,g-s,l,s,r.fixedRatio,r.minRatio,r.maxRatio,r.animate)}};if(!TB)throw new Error("You must include the OpenTok for WebRTC JS API before the layout-container library");TB.initLayoutContainer=function(t,i){return i=OT.$.defaults(i||{},{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,animate:!1,bigClass:"OT_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16}),t="string"==typeof t?OT.$(t):t,OT.onLoad(function(){r(t,i)}),{layout:r.bind(null,t,i)}}}();